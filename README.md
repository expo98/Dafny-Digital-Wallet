# Dafny Digital Wallet

A simple digital wallet specified and verified in Dafny, compiled to Python. The generated Python includes a small interactive CLI to create accounts, authenticate, check balances, transfer funds, and apply interest.

## Project Structure

- `DigitalWallet.dfy`: Dafny specification and implementation.
- `DigitalWallet-py/`: Python code generated by Dafny.
  - `__main__.py`: Interactive CLI entrypoint.
  - `module_.py`: Generated Python module for the wallet logic.
  - `_dafny/`, `System_/`: Dafny runtime helpers.
  - `DigitalWallet-py.dtr`: Dafny translation report.

## Prerequisites

- Python 3.8+ (recommended 3.10+)
- pip
- Dafny CLI (v4+)
  - Installation docs: https://dafny.org/dafny/ (ensure the `dafny` command is on your PATH)

## Setup

It's best to use a virtual environment:

```bash
python -m venv .venv
source .venv/bin/activate
pip install --upgrade pip
pip install DafnyRuntimePython
```

If you regenerate Python after editing `DigitalWallet.dfy`, re-activate the venv and ensure `DafnyRuntimePython` stays installed.

## Generate Python from Dafny

From the repository root, run:

```bash
dafny build --target:py --output:DigitalWallet-py DigitalWallet.dfy
```

This will (re)create `DigitalWallet-py/` with the generated modules and CLI.

## Run the CLI

Run the interactive CLI directly with Python:

```bash
python DigitalWallet-py/__main__.py
```

You should see a menu with options:
- New Account
- Authenticate (Check Attempts)
- Get Balance
- Transfer Funds
- Add Interest to All Accounts
- Quit

Notes:
- Amounts are integers representing minor units (e.g., 5000 = $50.00).
- On first launch, demo accounts are created: `101` (PIN `1234`) and `102` (PIN `4321`).
- Accounts may lock after too many failed authentication attempts.

## Development Tips

- After changing `DigitalWallet.dfy`, regenerate Python using the command above.
- Keep the CLI logic minimal; wallet behavior should live in Dafny so it remains verifiable.
- If you move files, ensure imports in `__main__.py` still resolve (it expects to run from the repo root as shown).

## Troubleshooting

- `ModuleNotFoundError: No module named '_dafny'` or similar: ensure you are running `python DigitalWallet-py/__main__.py` from the repo root so Python's module search path includes `DigitalWallet-py/`.
- `ImportError: No module named 'DafnyRuntimePython'`: run `pip install DafnyRuntimePython` in the active environment.
- `dafny: command not found`: install Dafny and ensure the `dafny` CLI is on your PATH.
